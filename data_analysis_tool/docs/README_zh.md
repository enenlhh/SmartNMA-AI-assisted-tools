# SmartEBM 数据分析智能体 - 完整文档

### 无代码网络荟萃分析与完美一致性验证

本项目由兰州大学 **SmartEBM (智慧循证医学) 团队** 开发和维护。我们的团队专注于设计**智能体 (intelligent agents)**，将复杂、类人的推理工作流嵌入到证据综合的全过程中。

本仓库包含 **SmartEBM 数据分析智能体**，这是我们为执行网络荟萃分析 (NMA) 中复杂统计计算而提供的无需编程知识的解决方案。

## 目录

1. [系统要求](#1-系统要求)
2. [安装指南](#2-安装指南)
3. [数据准备指南](#3-数据准备指南)
4. [R Shiny 界面工作流程](#4-r-shiny-界面工作流程)
5. [统计分析功能](#5-统计分析功能)
6. [输出结果解读](#6-输出结果解读)
7. [高级功能](#7-高级功能)
8. [性能优化](#8-性能优化)
9. [故障排除](#9-故障排除)
10. [技术架构](#10-技术架构)
11. [集成指南](#11-集成指南)
12. [最佳实践](#12-最佳实践)

## 1. 项目背景

系统评价和网络荟萃分析代表了循证医学的金字塔顶端。然而，它们的制作过程是众所周知的资源密集型。在数据提取完成后，统计分析阶段本身也带来了一系列挑战，通常需要专业的编程技能和对复杂统计软件包的深入理解。

作为我们使命的一部分，SmartEBM 团队正在开发一套 AI 智能体，以应对整个系统评价工作流程中的这些挑战。这种方法旨在显著减少人工工作量，加速证据综合过程，并使研究人员能够专注于更高层次的科学解读。

### SmartEBM 智能体生态系统

虽然本仓库专注于数据分析智能体，但它只是我们团队正在开发的更庞大智能体生态系统的一部分，该生态系统还包括：

-   **筛选智能体**: 自动化完成系统评价中的文题和摘要筛选。
-   **全文筛选智能体**: 筛选全文以确定最终纳入的研究。
-   **数据提取智能体**: 从纳入的研究中提取 PICOS 数据、研究特征和结局指标。
-   **偏倚风险 (RoB) 评估智能体**: 使用标准化工具自动化评估研究的偏倚风险。
-   **证据质量 (CoE) 评估智能体**: 辅助使用 GRADE 方法对证据质量进行分级。

这种模块化设计为证据综合提供了一个灵活而强大的端到端解决方案。

## 2. 智能体的工作流：核心功能

本智能体提供了一个用户友好的图形界面，无需任何编程知识即可进行全面的、基于频率学派的网络荟萃分析。它基于 R 语言中功能强大的 `netmeta` 包构建。

-   **交互式网页界面**: 智能体是一个独立的 R Shiny 应用程序，在您的本地网页浏览器中运行。所有分析参数都通过简单的下拉菜单、文本框和复选框进行配置。

-   **全面的 NMA 引擎**: 支持对二分类和连续性数据类型进行固定效应（共同效应）和随机效应模型的全套 NMA 计算。

-   **丰富的可视化套件**: 为每个结局指标自动生成一系列发表级别的图表，包括：
    -   **网络图 (Network Graphs)**: 用于可视化证据网络结构。
    -   **森林图 (Forest Plots)**: 用于展示每个干预措施相对于参照的效果估计值。
    -   **漏斗图 (Funnel Plots)**: 用于评估小样本效应和发表偏倚。
    -   **节点分裂图 (Node-Splitting Plots)**: 用于评估直接和间接证据之间的一致性。

-   **自动化报告**: 生成详细且易于解读的输出结果：
    -   **联赛表 (League Tables)**: 用于所有成对比较的结果。
    -   **干预措施排序 (Treatment Rankings)**: 使用 P-Score 估计干预措施的优劣排序。
    -   **统计报告 (Statistical Reports)**: 包括异质性统计量和发表偏倚检验结果（如 Egger's test）。

-   **批量处理与 GRADE 就绪输出**: 智能体可以一次性分析多个结局指标文件。它会生成结构化的数据文件（如 `meta_result_random.csv`），这些文件专门设计用作后续 **证据质量 (CoE) 评估智能体** 的输入。

## 3. 如何使用

请按照以下步骤开始使用本分析工具。

### 3.1. 先决条件

-   **R**: 您的计算机上必须安装 R，并能从系统的命令行/终端访问。您可以从 [CRAN 官网](https://cran.r-project.org/) 下载。
-   **Python 3+**: 用于运行简单的 `run.py` 启动脚本。

### 3.2. 安装

1.  克隆或下载本仓库：
    ```bash
    git clone https://github.com/enenlhh/SmartNMA-AI-assisted-tools.git
    cd SmartNMA-AI-assisted-tools/data_analysis_tool
    ```

2.  安装所需的 R 包。在项目目录中打开一个终端，并运行：
    ```bash
    Rscript install_packages.R
    ```
    该脚本将自动检查并安装所有必需的 R 依赖包。

### 3.3. 数据准备

智能体分析的准确性取决于正确格式化的输入数据。

-   请以 **`.xlsx` (Excel)** 格式准备您的数据。
-   每个结局指标必须存放在一个**独立的 Excel 文件**中。
-   文件名将被用作结局指标的名称（例如 `死亡率.xlsx`, `疼痛评分.xlsx`）。
-   请参考 `data_templates` 文件夹中的示例文件。

**二分类数据的必需列：**

| 列名      | 描述                                                       |
| :-------- | :--------------------------------------------------------- |
| `study`   | 研究标识符（例如 "Smith 2021"）。                          |
| `treatment` | 干预措施的名称（在所有研究中必须保持一致）。               |
| `event`   | 该干预组中的事件发生数。                                   |
| `n`       | 该干预组的总参与者数量。                                   |
| `ROB`     | 偏倚风险评估结果（`Low` 或 `High`）。                       |

**连续性数据的必需列：**

| 列名      | 描述                                                       |
| :-------- | :--------------------------------------------------------- |
| `study`   | 研究标识符。                                               |
| `treatment` | 干预措施的名称。                                           |
| `n`       | 该干预组的总参与者数量。                                   |
| `mean`    | 结局指标的均值。                                           |
| `sd`      | 结局指标的标准差。                                         |
| `ROB`     | 偏倚风险评估结果（`Low` 或 `High`）。                       |

### 3.4. 运行分析智能体

1.  数据文件准备好后，从您的终端运行主脚本以启动工具：
    ```bash
    python run.py
    ```
2.  此命令将启动一个本地 Web 服务器，并自动在您的默认浏览器中打开工具界面。
3.  在网页界面中：
    -   **上传数据**: 点击“Choose Files”并选择所有您准备好的 Excel 文件。
    -   **选择输出目录**: 点击“Select Folder”并选择一个用于保存所有结果的位置。
    -   **配置参数**: 使用右侧的面板选择数据类型、效应量、模型和其他分析参数。
    -   **开始分析**: 点击“🚀 Start Analysis”按钮。
4.  在“Analysis Status”部分监控分析进度。完成后，所有结果将被整理存放在您选择的输出目录中。

## 4. 理解输出结果

该工具会在您选择的输出目录中生成一套全面的结果，并为每个结局指标创建一个子文件夹。关键输出包括：

-   **`NMA_Methodology_Report.xlsx`**: 一份总结报告，详细说明了整个分析批次所使用的设置。
-   **特定结局的文件夹**:
    -   `[结局名称]-netgraph.pdf`: 证据网络的可视化图。
    -   `Results of Random Effect Model/` & `Results of Common Effect Model/`: 包含特定模型结果的子文件夹。
    -   **在模型文件夹内**:
        -   `forestplot.pdf`: 干预效果的森林图。
        -   `nettable.xlsx`: 包含效应估计值、置信区间和异质性的表格。
        -   `league table.xlsx`: 成对比较的联赛表矩阵。
        -   `Pscore.txt`: 干预措施排序结果。
        -   `egger_test_results.csv`: 发表偏倚检验结果。
        -   `meta_result_random.csv`: **为 GRADE 智能体准备的关键输入文件。**

### 重要提示：专家解读至关重要

这是一个统计计算工具，不能替代科学判断。您的 NMA 的有效性取决于输入数据的质量以及对统计输出的正确解读。请务必审查一致性分析、发表偏倚评估和异质性统计数据，以确保您研究结果的稳健性。

## 5. 项目结构

```
.
├── data_templates/         # 用于数据格式化的示例Excel文件
│   ├── Binary outcome.xlsx
│   └── Continues outcome.xlsx
├── app.R                   # 核心的 R Shiny 应用程序逻辑
├── run.py                  # 用于启动应用的 Python 脚本
├── install_packages.R      # 用于安装 R 依赖包的脚本
└── README.md               # 本文件
```

## 6. 引用

本工具是 SmartEBM 团队研究工作的直接产出。如果您在学术工作中使用本工具，我们恳请您引用我们的手稿，该手稿详细介绍了本模块所属的更广泛框架的设计和验证：

> Lai H, Liu J, Ma N, et al. Design and Validation of SmartNMA: A Comprehensive Large Language Model-Assisted Framework for Network Meta-Analysis. (手稿准备中).